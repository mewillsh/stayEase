Here's a **clean, revision-friendly version** of your notes — perfect for quick review before a test, demo, or project submission.

---

## 📝 EJS + Express + Mongoose: Form & Route Revision Notes

---

### 🔧 Form Structure (EJS)

**Goal**: Send nested data for Mongoose using bracket notation (`listing[...]`)

```html
<form action="/listings" method="POST">
  <input name="listing[title]" placeholder="Title">
  <textarea name="listing[description]" placeholder="Description"></textarea>
  <input name="listing[image][url]" placeholder="Image URL">
  <input name="listing[price]" placeholder="Price">
  <input name="listing[location]" placeholder="Location">
  <input name="listing[country]" placeholder="Country">
  <button>Add</button>
</form>
```

---

### 📥 Form Data Parsing

* Use `app.use(express.urlencoded({ extended: true }));`
* Ensures Express can parse **nested input** like `listing[image][url]`

---

### 🧱 Mongoose Object Mapping

**Form Input** → `req.body` (after submission):

```js
req.body = {
  listing: {
    title: "...",
    description: "...",
    image: {
      url: "..."
    },
    price: "...",
    location: "...",
    country: "..."
  }
}
```

---

### 🧪 Create Mongoose Instance

```js
const newListing = new Listing(req.body.listing);
await newListing.save();
res.redirect("/listings"); // redirects to GET /listings
```

---

### 🌐 Route Order (Important!)

> Always place more specific routes **before** dynamic ones.

✅ Correct:

```js
app.get("/listings/new");     // should come first
app.get("/listings/:id");     // this can catch "/new" as :id if placed before
```

❌ Wrong:

```js
app.get("/listings/:id");     // catches "/new" as an ID
app.get("/listings/new");     // never reached
```

---

### 🛠️ Route Recap

| Method | Path            | Purpose             |
| ------ | --------------- | ------------------- |
| GET    | `/listings`     | Show all listings   |
| GET    | `/listings/new` | Form to add listing |
| POST   | `/listings`     | Handle form data    |
| GET    | `/listings/:id` | Show listing detail |

---

### ⚠️ Common Mistakes & Fixes

| Mistake                            | Fix                                                |
| ---------------------------------- | -------------------------------------------------- |
| `type="text"` on `<textarea>`      | ❌ Not allowed — just remove `type`                 |
| `name="image.url"`                 | ❌ Won't nest — use `listing[image][url]`           |
| Not using `extended: true`         | ❌ No nested parsing — use it in Express config     |
| `/listings/:id` before `/new`      | ❌ Treats `"new"` as ID — always place `/new` first |
| Not wrapping inputs in `listing[]` | ❌ Can't use `req.body.listing` in backend          |

---

Would you like this as a downloadable `.md` file or want to save it as part of your project documentation?
