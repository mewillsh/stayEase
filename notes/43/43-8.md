Here’s your **revision-friendly Markdown notes file** for today's learning, covering:

* Edit and Update routes
* Method override
* How form data is deconstructed
* How to pre-fill form values

---

### 📄 `edit-and-update-listing.md`

````md
# 🛠️ Edit & Update Routes in Express with Mongoose and EJS

---

## ✅ Setup: Method Override Middleware

```js
const methodOverride = require("method-override");
app.use(methodOverride("_method"));
````

### 📌 Why?

* HTML forms only support `GET` and `POST`.
* `method-override` lets us simulate `PUT` or `DELETE` using a query param like `?_method=PUT`.

---

## ✏️ Edit Route (GET)

```js
app.get("/listings/:id/edit", async (req, res) => {
  let { id } = req.params;
  const listing = await Listing.findById(id);
  res.render("listings/edit", { listing });
});
```

### 📌 What it does:

* Finds the listing by ID
* Passes it to the `edit.ejs` form
* Pre-fills the form with current values using `<%= %>`

---

## 📤 Update Route (PUT)

```js
app.put("/listings/:id", async (req, res) => {
  let { id } = req.params;
  await Listing.findByIdAndUpdate(id, { ...req.body.listing });
  res.redirect(`/listings/${id}`);
});
```

### 📌 What’s Happening:

* Destructures form input: `req.body.listing`
* Uses spread operator `...` to unpack values into Mongoose update
* Redirects back to the show page after update

---

## 🧾 `edit.ejs` Form Structure

```html
<form action="/listings/<%= listing._id %>?_method=PUT" method="POST">
  <input name="listing[title]" value="<%= listing.title %>" type="text">
  <textarea name="listing[description]"><%= listing.description %></textarea>
  <input type="text" name="listing[image][url]" value="<%= listing.image.url %>">
  <input name="listing[price]" value="<%= listing.price %>" type="text">
  <input name="listing[location]" value="<%= listing.location %>" type="text">
  <input name="listing[country]" value="<%= listing.country %>" type="text">
  <button>Edit</button>
</form>
```

---

## 🔗 Edit Link

```ejs
<a href="/listings/<%= listing._id %>/edit">Edit this Listing</a>
```

---

## ⚠️ Common Mistakes

| Mistake                                 | Fix                                                    |
| --------------------------------------- | ------------------------------------------------------ |
| Not using method override               | Add `app.use(methodOverride("_method"))`               |
| Using `type="text"` on `<textarea>`     | ❌ Remove `type` — not valid for `<textarea>`           |
| Forgetting `_method=PUT` in form action | Must use it for `PUT` to work with method override     |
| Not wrapping form inputs in `listing[]` | ❌ Won’t match schema — use `listing[field]` everywhere |
| Not pre-filling form with EJS values    | Use `<%= value %>` to inject listing data              |

---

## ✅ Summary Steps to Enable Edit & Update

1. **Enable method override**: `app.use(methodOverride("_method"))`
2. **Create edit route**: `GET /listings/:id/edit`
3. **Render form with existing values**
4. **Submit form with `_method=PUT`**
5. **Handle `PUT /listings/:id` route**
6. **Update DB with spread: `{ ...req.body.listing }`**
7. **Redirect back to show page**

---

✅ You now know how to:

* Render editable form values
* Use method override
* Safely update MongoDB entries with Express + Mongoose

```

---

Would you like this exported as a downloadable `.md` file or want it saved in a GitHub-style format for your project repo?
```
